<% if user_signed_in? %>
  <nav id="sidebarMenu" class="sidebar d-flex flex-column flex-shrink-0 bg-light position-fixed" style="width: 250px; height: 100vh; z-index: 1040;">
    <div class="sidebar-logo">
      <div class="mascot-circle">
        <img src="https://res.cloudinary.com/dgx2lulyv/image/upload/v1749479161/Transparent_Logo_jsvqfa.png" alt="StudySpark Bunny" />
      </div>
      <h2 class="mt-2 mb-0" style="font-size: 1.1rem; letter-spacing: 1px;">StudySpark</h2>
    </div>
    <div class="sidebar-menu mt-3">
      <ul class="nav flex-column mb-auto list-unstyled">
        <li>
          <%= link_to dashboard_path, class: "d-flex align-items-center gap-2 sidebar-link #{'active' if current_page?(dashboard_path)} fw-bold justify-content-center" do %>
            <i class="bi bi-house-door"></i>
            <span>My Dashboard</span>
          <% end %>
        </li>
        <li class="mt-3 mb-1 d-flex align-items-center justify-content-center fw-bold" style="cursor:pointer; user-select:none;" data-bs-toggle="collapse" data-bs-target="#studiesCollapse" aria-expanded="true" aria-controls="studiesCollapse">
          <span>My Studies</span>
          <i class="fa-solid fa-chevron-down transition ms-2" id="studiesCollapseArrow"></i>
        </li>
        <ul class="collapse show list-unstyled" id="studiesCollapse">
          <% if current_user.studies.any? %>
            <% current_user.studies.each do |study| %>
              <li>
                <%= link_to study_path(study), class: "d-flex align-items-center gap-2 sidebar-link #{'active' if current_page?(study_path(study))}" do %>
                  <i class="bi bi-journal-bookmark"></i>
                  <span>Grade <%= study.subject.grade_level %> | <%= study.subject.name %></span>
                <% end %>
              </li>
            <% end %>
          <% else %>
            <li class="sidebar-link text-muted px-3">No studies found</li>
          <% end %>
        </ul>
      </ul>
      <hr>
      <ul class="nav flex-column mb-auto list-unstyled">
        <li>
          <%= link_to tutors_path, class: "d-flex align-items-center gap-2 sidebar-link #{'active' if controller_name == 'tutors'}" do %>
            <i class="bi bi-person-video3"></i>
            <span>Browse Tutors</span>
          <% end %>
        </li>
      </ul>
      <div>
        <%= link_to destroy_user_session_path, { data: { turbo_method: :delete }, class: "nav-link text-danger d-flex align-items-center gap-2" } do %>
          <i class="bi bi-box-arrow-right"></i>
          <span>Log out</span>
        <% end %>
      </div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var studiesCollapse = document.getElementById('studiesCollapse');
        var arrow = document.getElementById('studiesCollapseArrow');
        if (studiesCollapse && arrow) {
          studiesCollapse.addEventListener('show.bs.collapse', function () {
            arrow.classList.remove('rotate-180');
          });
          studiesCollapse.addEventListener('hide.bs.collapse', function () {
            arrow.classList.add('rotate-180');
          });
        }
      });
    </script>
  </nav>
<% end %> 