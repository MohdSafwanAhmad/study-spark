<div class="container py-4">
  <!-- Header Section -->
  <div class="tutor-card mb-4">
    <div class="tutor-info">
      <h1 class="mb-2"><%= @study.subject.name %></h1>
      <div class="mb-2">
        <span class="badge bg-light-purple text-purple">Grade <%= @study.subject.grade_level %></span>
      </div>
      <div class="mb-3">
        <h3 class="mb-1">Learning Objective:</h3>
        <p><%= @study.learning_objective %></p>
      </div>
      <%= link_to "Back to Dashboard", dashboard_path, class: "btn btn-purple btn-sm rounded-pill mb-2" %>
    </div>
  </div>

  <div class="row">
    <!-- Materials Section -->
    <div class="col-lg-8 mb-4">
      <div class="tutor-card">
        <div class="tutor-info">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="mb-0">Study Materials</h2>
            <% if @materials.any? %>
              <%= link_to "Upload New Material", new_study_material_path(@study), class: "btn btn-purple btn-sm rounded-pill" %>
            <% end %>
          </div>
          <% if @materials.any? %>
            <div class="d-flex flex-column gap-3">
              <% @materials.each do |material| %>
                <div class="tutor-card p-3 mb-2">
                  <div class="tutor-info">
                    <h3 class="mb-1"><%= material.name %></h3>
                    <% if material.description.present? %>
                      <p class="mb-2"><%= material.description %></p>
                    <% end %>
                    <div class="mb-2">
                      <span class="badge bg-light-purple text-purple"><%= material.format&.upcase || 'N/A' %></span>
                      <% if material.file.attached? %>
                        <span class="ms-2"><%= number_to_human_size(material.file.byte_size) %></span>
                      <% end %>
                    </div>
                    <% if material.file.attached? %>
                      <%= link_to "Download", rails_blob_path(material.file, disposition: "attachment"), class: "btn btn-purple btn-sm rounded-pill me-2" %>
                      <%= link_to "View", rails_blob_path(material.file), target: "_blank", class: "btn btn-outline-purple btn-sm rounded-pill" %>
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="text-center py-4 text-muted">
              <p>No materials yet. Get started by uploading your first study material.</p>
              <%= link_to "Upload Material", new_study_material_path(@study), class: "btn btn-purple btn-sm rounded-pill mt-2" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Available Tutors Section -->
    <div class="col-lg-4 mb-4">
      <div class="tutor-card">
        <div class="tutor-info">
          <h2 class="mb-3">Available Tutors</h2>
          <% if @available_tutors.any? %>
            <div class="d-flex flex-column gap-3">
              <% @available_tutors.each do |tutor| %>
                <% expertise = tutor.expertises.find_by(subject: @study.subject) %>
                <div class="tutor-card p-3 mb-2">
                  <div class="tutor-info">
                    <h3 class="mb-1"><%= tutor.first_name %> <%= tutor.last_name %></h3>
                    <p class="text-purple mb-1">
                      $<%= number_with_precision(expertise.tutor_rate / 100.0, precision: 2) %>/hour
                    </p>
                    <% if tutor.bio.present? %>
                      <p class="mb-2"><%= tutor.bio %></p>
                    <% end %>
                    <%= link_to "Book Session", new_tutoring_session_path(tutor_id: tutor.id), class: "btn btn-purple btn-sm rounded-pill w-100" %>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="text-center py-4 text-muted">
              <p>No tutors available for this subject yet.</p>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Study Progress Section -->
      <div class="tutor-card mt-4">
        <div class="tutor-info">
          <h2 class="mb-3">Study Progress</h2>
          <div class="mb-2 d-flex justify-content-between">
            <span>Materials Reviewed</span>
            <span><%= @materials.count %> items</span>
          </div>
          <div class="progress mb-3">
            <div class="progress-bar bg-purple" role="progressbar" style="width: 45%"></div>
          </div>
          <div class="mb-2 d-flex justify-content-between">
            <span>Total Materials:</span>
            <span><%= @materials.count %></span>
          </div>
          <div class="mb-2 d-flex justify-content-between">
            <span>Available Tutors:</span>
            <span><%= @available_tutors.count %></span>
          </div>
          <div class="mb-2 d-flex justify-content-between">
            <span>Started:</span>
            <span><%= @study.created_at.strftime("%b %d, %Y") %></span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
